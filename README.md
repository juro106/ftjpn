# ftjpn 日本語編集のときも`f`と`t`を便利に使おう

日本語編集時の`f`,`t`,`F`,`T`を使った移動、削除やヤンク、ビジュアルモードの範囲選択を便利にするための Vim Plugin です。

## このプラグインで出来ること

### `.`よ、起きて働け もっと働け

日本語（全角文字）の編集で`f`や`t`をまともに機能させるには、その都度IMEを切り替えるか、migemo や digraph を使う必要があります。

これらの方法は英語を使っているときに比べて大幅にタイプ数が増えるのが弱点です。かといって新たにキーをマッピングすると今度は覚える手間が増えます。

日本語のときは`f<C-k>_.`で英語のときは`f.`、というように操作が異なるのは混乱の元なので出来れば避けたいでしょう。たとえ短縮のマップを設定したとしても限度があり、根本的な解決にはなりません。

しかし、このプラグインを使えば`.`に`.`と`。`の２つを担当させることができます。

つまり、`f.`で`。`と`.`の両方に移動できるようになるということです。英語だろうが日本語だろうが全く同じ動作で仕事が済んでしまいます。

もちろん「`df.`で`。`まで削除」、「`vt.`で`。`の手前まで選択」といったおなじみの操作も英語のときと同じように違和感なく使えます。まあ素敵。

## 一人二役（それ以上でも可能）

### オプション: キーの設定

```
let g:ftjpn_key_list = [
 \ ['.', '。', '．'],
 \ ]
```
vimrcで上のように設定すると以下のように動作します。

|キー|操作|
|--|--|
|f.| 前方最寄りの`.` or `。` or `．`に移動|
|t.| 前方最寄りの`.` or `。` or `．`の手前まで移動|
|df.|前方最寄りの`.` or `。` or `．`まで削除|
|dt.|前方最寄りの`.` or `。` or `．`の手前まで移動|
|cf.|前方最寄りの`.` or `。` or `．`まで削除して挿入モードへ入る|
|ct.|前方最寄りの`.` or `。` or `．`の手前まで削除して挿入モードへ入る|
|yf.|前方最寄りの`.` or `。` or `．`までヤンク|
|yt.|前方最寄りの`.` or `。` or `．`の手前までヤンク|
|vf.|前方最寄りの`.` or `。` or `．`まで選択|
|vt.|前方最寄りの`.` or `。` or `．`の手前まで選択|

### つまり基本的にデフォルトと同じ。何も変わりません。

`F`、`T`は後方。`;`で順方向、`,`で逆方向へ繰り返し。カウントにも対応しています。

## インストール

vim-plug
```
Plug 'juro106/ftjpn'
```

## 設定例

```
let g:ftjpn_key_list = [
    \ ['.', '。', '．'],
    \ [',', '、', '，'],
    \ ['t', 'と'],
    \ ['n', 'に'],
    \ ['w', 'を'],
    \ ['h', 'は'],
    \ ['g', 'が'],
    \ ['d', 'で'],
    \ ['o', 'の'],
    \ ['i', '何'],
    \ ['c', '（', '）'],
    \ ['k', '「', '」', '『', '』', '【', '】'],
    \ ['!', '！'],
    \ ['?', '？'],
    \ [';', '!', '?', '^', '$', '#', ':', '&', '%', '~', '*', '！', '？'],
    \ ]
```

`.`や`,`以外にアルファベットや数字、記号に対応した文字を設定可能です。

これによって例えば半角の`!`と全角の`！`の2つの文字に対して半角の`!`で反応するようになるので、いちいちIMEを切り替えなくても`f!`で移動したり`df!`で削除、`vt!`で手前まで選択といった動作が簡単になります。

`が`、`と`、`を`、`は`など、文章の中で区切りになりやすい文字を設定しておくと移動がぐんと楽になります。

必ずしもペアである必要はなく、1つのキー対して複数の文字を設定することも可能です（便利になるかはさておき）。

`;`に複数の記号を設定しておけば、`f;`と打つだけで色々な記号に移動できるようになるので、打ちにくいシフトキーとのペアを打鍵する手間が省けます（記号だらけの行では却って邪魔になることもあると思いますが）。

## `f`, `t`, `F`, `T`のキーマッピング

`f`,`t`,`F`,`T`を別なキーに設定したい場合。

``` vim
let g:ftjpn_no_defalut_key_mappings = 1

let g:ftjpn_f = 'f'
let g:ftjpn_F = 'F'
let g:ftjpn_t = 't'
let g:ftjpn_T = 'T'
```

キーマップを変える場合、vimrcに `let g:ftjpn_no_defalut_key_mappings = 1` としてから、各キーを設定して下さい。

## 欠点: 英語と日本語が混ざっているときがめんどう

例文 1) Hello World. 私は日本人です。東京から来ました。My name is Vim.

カーソルが行頭にあり、`私は日本人です。`の`。`に直接移動したい時。`f.`と打っても`Hello World.`の`.`が選ばれてしまいます。

こういう場合は`f。`と打つか（めんどくさい…）、あるいは`f.` `f.`（ちょっと大変）と２回続けることでようやく`私は日本人です。`の`。`に移動出来ます。近いほうが選ばれてしまう弊害です。

例文 2) こんにちは世界。I am Japanese. I am from Tokyo. 私の名前はヴィムです。

この場合も同様の困難が待ち受けています。

行頭で`f.`とすると、`こんにちは世界。`の`。`へと移動してしまいます。例 1)と同じく`f.`を２回繰り返すことになります。

もう１つの解決策は`f`を押して1秒以上待つことです（timeoutやtimeoutlen等の設定を変えていなければ）。そうすれば`f`は通常の`f`になり、`.`を押しても`。`は無視されて`I am Japanes.`の`.`へ移動出来ます。

逆に言えばデフォルトのオペレータ待機モードのように永遠に待ってはくれないということです。`df`や`cf`、`yf`、`vf`のときも同様です。

さらにもう１つ、これは混乱を招きそうですが`。`を`.`ではないキーに設定してしまえば被ることはなくなります。

弊プラグインはこのような欠陥を抱えていますが、1行の中に日本語の`。`と英語の`.`がごちゃまぜで書かれていることは稀なので問題になることはあまりないと思われます（強いて挙げればこのREADMEぐらいのものではないでしょうか）。


これらの欠点があなたにとって些細な問題であることを願います。

## キー設定のコツを模索中

`fe`があまり有効ではないのと同じように、日本語も出現率が高い文字を設定しても役に立たないでしょう。

かといって、そもそもあまり出てこない文字では全く意味がありません。

上手いこと区切りとして優秀な文字を設定できれば`f`の移動がかなり快適になるとはずです。制限された枠組みの中で最適解を導き出す…ワクワクしますね。

参考までに私が考えた例を掲載します。

### S級
|日本語|key 候補|意味合い|
|--|--|--|
|が|g|Subject, but
|を|w,o|Object
|は|h|is
|と|t,o|and, with
|て|t,e|and
|に|n,i|to
|の|n,o|'s
|で|d,e,|by

主語や目的語の近くに現れる文字を設定しておきたいところです。

### A級
|日本語|key 候補|意味合い|
|--|--|--|
|へ|h,e|to
|で|d,e|by
|だ|d,a|$
|な|n,a|like
|ば|b|and 
|し|s,i|do
|す|s,u|do,$ 
|る|r,u|do,$
|た|t,a|did
|か|k|or 
|こ|k,o|thing
|よ|y,o|by
|こ|k,o|
|ま|m,a|

`る`や`か`はたくさん出てきますが、案外微妙な場所に出現することが多い印象です。移動した後には当然消去かヤンクをしたいはずなので、「だったら別な場所行くわ」という扱いになってしまいます。

### 漢字
|日本語|key 候補|意味合い|
|--|--|--|
|何|n,i,w|what,why
|時|j,z,t,i|when
|誰|w,h,d|who
|場|b,w,a|where
|所|t,w,s|where
|方|h,o,u|how
|法|h,o,u|how
|同|=|
一|1||
二|2||
三|3||
四|4||
五|5||
六|6||
七|7||
八|8||
九|9||

漢字を目印にするのはあまり上手い作戦ではないような気がしていますが、あればあったで便利かもしれません。

### カッコ系
|カッコ|key 候補 |
|--|--|
|「」 |k
|「 |k
|」|K
| （）|c
| （）|(
| 【】|b,
| 『』|K
| ‘’|'
| “”|"
| 〈〉|<
| 〔〕|
| ｛｝|
