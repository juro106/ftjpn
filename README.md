# ftjpn

ftjpn は 日本語編集時の`f`,`t`,`F`,`T`を使った移動や削除、ビジュアルモードの範囲選択を便利にするための Vim Plugin です。

## インストール

```
" vim-plug
Plug 'juro106/ftjpn'
```

## このプラグインで出来ること・特徴

- `f` `F` `t` `T` にまつわる日本語と英語の操作を統一できます。
- 新たに別なキーの組み合わせを増やさずに済みます。
- 独自のキー、組み合わせを無数に設定できます。

日本語（全角文字）の編集で`f`や`t`をまともに機能させるには、その都度IMEを切り替えるか、migemo や digraph を使う必要があります。

これらの方法は英語を使っているときに比べて大幅にタイプ数が増えるのでめんどうです。かといって新たに別なキーをマッピングすると今度は覚える手間が増えます。

日本語のときは`f<C-k>_.`で英語のときは`f.`、というように操作が異なるのは混乱の元なので出来れば避けたいでしょう。たとえ短縮のマップを設定したとしても限度があり、根本的な解決にはなりません。

`。` に移動したいのにうっかり `<C-k>` を忘れて `.` を押してしまったり、あるいはその逆を…なんてことがあるんじゃないでしょうか。

しかし、このプラグインを使えば`f.`で`。`と`.`の両方に移動できるようになる。つまり、英語だろうが日本語だろうが全く同じ動作で仕事が済んでしまうということです。

もちろん「`df.` → `。`まで削除」、「`vt.` → `。`の手前まで選択」といったおなじみの操作も英語のときと同じように違和感なく使えます。

## キーの設定例

そのままだと何も設定されていないので vimrc に以下のように記述する必要があります。

```
let g:ftjpn_key_list = [
    \ ['.', '。', '．'],
    \ [',', '、', '，'],
    \ ['t', 'て'],
    \ ['i', 'に'],
    \ ['w', 'を'],
    \ ['h', 'は'],
    \ ['n', 'の'],
    \ ['g', 'が'],
    \ ['d', 'で'],
    \ ['r', 'る'],
    \ ['o', 'と'],
    \ ['s', 'す'],
    \ ['k', 'か', '「', '」'],
    \ ['[', '「'],
    \ [']', '」'],
    \ ]
```
たとえば vimrc で上のように設定すると以下のように動作します。

|キー|操作|
|--|--|
|f.| 前方最寄りの`.` or `。` or `．`に移動|
|t.| 前方最寄りの`.` or `。` or `．`の手前まで移動|
|df.|前方最寄りの`.` or `。` or `．`まで削除|
|dt.|前方最寄りの`.` or `。` or `．`の手前まで移動|
|cf.|前方最寄りの`.` or `。` or `．`まで削除して挿入モードへ入る|
|ct.|前方最寄りの`.` or `。` or `．`の手前まで削除して挿入モードへ入る|
|yf.|前方最寄りの`.` or `。` or `．`までヤンク|
|yt.|前方最寄りの`.` or `。` or `．`の手前までヤンク|
|vf.|前方最寄りの`.` or `。` or `．`まで選択|
|vt.|前方最寄りの`.` or `。` or `．`の手前まで選択|

1行の中に `.` と `。` と `．` が混在している場合、カーソルから最も近い文字が操作対象になります。しかし、そのような状況はほぼ皆無でしょう（このREADMEくらいなものです）。

### つまり基本的にデフォルトと同じ。何も変わりません。

`F`、`T`は後方。`;`で順方向、`,`で逆方向へ繰り返し。カウントにも対応しています。

## キーの設定例

`let g:ftjpn_key_list` にリスト型かディクショナリ型で設定します。

### リスト型
```

let g:ftjpn_key_list = [
    \ ['.', '。', '．'],
    \ [',', '、', '，'],
    \ ['t', 'と'],
    \ ['n', 'に'],
    \ ['w', 'を'],
    \ ['h', 'は'],
    \ ['g', 'が'],
    \ ['d', 'で'],
    \ ['o', 'の'],
    \ ['i', '何'],
    \ ['c', '（', '）'],
    \ ['k', '「', '」', '『', '』', '【', '】'],
    \ ['!', '！'],
    \ ['?', '？'],
    \ [';', '!', '?', '^', '$', '#', ':', '&', '%', '~', '*', '！', '？'],
    \ ]
```
リストの先頭の文字が、`f` や `t` の後に使うキーの文字になります。

### ディクショナリ型

```
let g:ftjpn_key_list = {
    \ ".": ['.', '。', '．'],
    \ ",": [',', '、', '，'],
    \ "t": ['t', 'と'],
    \ "w": ['を'], 
    \ }
```

変数名は `g:ftjpn_key_list` のままです。ディクショナリのキーがそのままキーになる文字。リストに移動先を指定します。

リストの中に key の文字が含まれていなくても、移動先の文字として有効になります。例えば 'w' に「を」だけを設定した状態でも、'hello world' の行の先頭で `fw` を実行すれば 'w' に移動します。常に通常の動作は有効なままです。

`.`や`,`以外にもアルファベットや数字、記号、あらゆる文字をいくつでも設定可能です（意味はありませんが全角文字をキーにすることも可能です）。

これによって半角の`!`で全角の`！`に対しても動作するようになるので、いちいちIMEを切り替えなくても`f!`で移動したり`df!`で削除、`vt!`で手前まで選択といったことが可能になります。

### `t` で助詞の１つ前の単語に移動できるとすごく便利

`['g', 'が']`、`['t', 'と']`、`['w', 'を']`、`['h', 'は']`、`['n', 'に']` など、文章の中で区切りになりやすい文字を設定しておくと移動がぐんと楽になります。

`太郎と花子は新しいソファーを買うために街へ出掛けた。`

上のような文章なら `tw` で `ソファーを` の１つ前の `ー` に移動して `ciw`。そして `テーブル` へ書き換え、といった操作がスムーズに行えます。

### １つのキーに複数の文字を担当させる

また、キーは必ずしもペアである必要はなく、1つのキー対して複数の文字を設定することも可能です（便利になるかはさておき）。

`;`に複数の記号を設定しておけば、`f;`と打つだけで色々な記号に移動できるようになり、打ちにくいシフトキーとのペアを打鍵する手間が省けます（記号だらけの行では却って邪魔になることもあると思いますが）。

## 欠点: 英語と日本語が混ざっているときがめんどう

### 例文 1) Hello World. 私は日本人です。東京から来ました。My name is Vim.

カーソルが行頭にあり、`私は日本人です。`の`。`に直接移動したい時。`f.`と打っても`Hello World.`の`.`が選ばれてしまいます。

こういう場合は`f。`と打つか（めんどくさい…）、あるいは`f.` `f.`（ちょっと大変）と２回続けることでようやく`私は日本人です。`の`。`に移動出来ます。近いほうが選ばれてしまう弊害です。

### 例文 2) こんにちは世界。I am Japanese. I am from Tokyo. 私の名前はヴィムです。

この場合も同様の困難が待ち受けています。

行頭で`f.`とすると、`こんにちは世界。`の`。`へと移動してしまいます。`I am Jananese.`の`.`に移動するには`f.`を２回繰り返さなければなりません。

もう１つの解決策は`f`を押して1秒以上待つことです（timeoutやtimeoutlen等の設定を変えていなければ）。そうすれば`f`は通常の`f`になり、`.`を押しても`。`は無視されて`I am Japanes.`の`.`へ移動出来ます。

逆に言えばデフォルトのオペレータ待機モードのように永遠に待ってくれず、さっさと入力しないと時間切れになるということです。`df`や`cf`、`yf`、`vf`のときも同様です。

さらにもう１つ、これは混乱を招きそうですが`。`を`.`ではないキーに設定してしまえば被ることはなくなります。独自のかな入力を使っている場合などは却って好都合かもしれません。

これらの欠点があなたにとって些細な問題であることを願います。

## 操作が追いつかない時

`f` を押してから時間切れまでが短いと感じる時は `vimrc` に `set notiemout` と記述すれば `f` の次のキーが入力されるまで永遠に待つようになるのでゆっくり入力できます。

または `set timeoutlen=3000` ぐらいに設定するのもひとつの手です（デフォルトは1秒 timeoutlen=1000）。

しかし、ほかに設定しているキーマップが機能しなくなる場合もありますので事前に確認をお願いします。

``` 
nnoremap g<C-a> ggVG
nnoremap g<C-a>y ggVGy
```

上のような設定をしてある状態で `set notimeout` としてしまうと、`g<C-a>` は`<CR>`を押さない限りいくら待っても発射されなくなります（それだとキーマップの威力が半減どころではありませんよね…）。

## キー設定のコツを模索中

`fe`があまり有効ではないのと同じように、日本語も出現率が高い文字を設定しても役に立たないでしょう。

かといって、そもそもあまり出てこない文字では全く意味がありません。

上手いこと区切りとして優秀な文字を設定できれば`f`の移動がより快適になるでしょう。制限された枠組みの中で最適解を導き出す…ワクワクしますね。

参考までに私が考えた例を掲載します。

### S級
|日本語|key 候補|意味合い|
|--|--|--|
|が|g|Subject, but
|を|w,o|Object
|は|h|is
|と|t,o|and, with
|て|t,e|and
|に|n,i|to
|の|n,o|'s
|で|d,e,|by

主語や目的語の近くに現れる文字を設定しておきたいところです。

### A級
|日本語|key 候補|意味合い|
|--|--|--|
|へ|h,e|to
|で|d,e|by
|だ|d,a|$
|な|n,a|like
|ば|b|and 
|し|s,i|do
|す|s,u|do,$ 
|る|r,u|do,$
|た|t,a|did
|か|k|or 
|こ|k,o|thing
|よ|y,o|by
|こ|k,o|
|ま|m,a|

`る`や`か`はたくさん出てきますが、案外微妙な場所に出現することが多い印象です。移動した後には当然消去かヤンクをしたいはずなので、「だったら別な場所行くわ」という扱いになってしまいます。

### 漢字
|日本語|key 候補|意味合い|
|--|--|--|
|何|n,i,w|what,why
|時|j,z,t,i|when
|誰|w,h,d|who
|場|b,w,a|where
|所|t,w,s|where
|方|h,o,u|how
|法|h,o,u|how
|同|=|
一|1||
二|2||
三|3||
四|4||
五|5||
六|6||
七|7||
八|8||
九|9||

漢字を目印にするのはあまり上手い作戦ではないような気がしていますが、あればあったで便利かもしれません。

### カッコ系
|カッコ|key 候補 |
|--|--|
|「」 |k
|「 |k
|」|K
| （）|c
| （）|(
| 【】|b,
| 『』|K
| ‘’|'
| “”|"
| 〈〉|<
| 〔〕|k
| ｛｝|k
